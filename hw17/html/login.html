<!DOCTYPE html>
<html lang="he">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <main class="card">
      <h1 class="center">התחברות</h1>

      <!-- טופס רגיל (POST /login) -->
      <form
        action="/login"
        method="post"
        class="stack"
        style="margin-bottom: 12px"
      >
        <label for="email">Email</label>
        <input id="email" name="email" type="email" required />

        <label for="password">Password</label>
        <input id="password" name="password" type="password" required />

        <button>Sign in</button>
      </form>

      <div class="center">
        <a href="/signup">Sign up</a> · <a href="/forgot">Forgot password?</a>
      </div>

      <hr />

      <!-- BONUS גדול: התחברות ב-FETCH ללא רענון -->
      <h3>Login via Fetch (Bonus)</h3>
      <div class="stack">
        <input id="f-email" type="email" placeholder="Email" />
        <input id="f-password" type="password" placeholder="Password" />
        <button id="f-login">Sign in (Fetch)</button>
        <div id="f-msg" class="center" style="font-weight: 700"></div>
      </div>
    </main>

    <script>
      const btn = document.getElementById("f-login");
      btn.addEventListener("click", async () => {
        const email = document.getElementById("f-email").value;
        const password = document.getElementById("f-password").value;

        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });

        const out = document.getElementById("f-msg");
        if (!res.ok) {
          const txt = await res.text();
          out.textContent = txt || "Error";
          return;
        }
        const data = await res.json();
        // מציגים HELLO USERNAME באותו עמוד בעזרת DOM
        out.textContent = `HELLO ${data.username}`;
      });
    </script>
  </body>
</html>
